- pk: 9
  extend: *base_release
  fields:
    name: "Liberty+Citrix XenServer on Ubuntu 14.04"
    version: "liberty-8.0"
    can_update_from_versions: []
    operating_system: "Ubuntu"
    description: "This option will install the OpenStack Liberty packages using Ubuntu as a base operating system. With high availability features built in, you are getting a robust, enterprise-grade OpenStack deployment."
    roles_metadata:
      controller:
        name: "Controller"
        description: "The Controller initiates orchestration activities and provides an external API.  Other components like Glance (image storage), Keystone (identity management), Horizon (OpenStack dashboard) and Nova-Scheduler are installed on the controller as well."
        weight: 10
        conflicts:
          - compute
        update_required:
          - compute
          - cinder
        has_primary: true
        public_ip_required: true
        public_for_dvr_required: true
        limits:
          min: 1
          recommended: 3
          overrides:
            - condition: "cluster:mode == 'multinode'"
              max: 1
              message: "Multi-node environment can not have more than one Controller node."
            - condition: "cluster:mode == 'ha_compact'"
              recommended: 3
              message: "At least 3 Controller nodes are recommended for HA deployment."
      compute:
        name: "Compute"
        description: "A Compute node creates, manages, and terminates virtual machine instances."
        weight: 20
        public_for_dvr_required: true
        limits:
          recommended: 1
        fault_tolerance: "2%"
      cinder:
        # NOTE: naming, see https://bugs.launchpad.net/fuel/+bug/1383224
        name: "Storage - Cinder"
        description: "Cinder provides scheduling of block storage resources, typically delivered over iSCSI and other compatible backend storage systems. Block storage can be used for database storage, expandable file systems, or to provide a server with access to raw block level devices."
        weight: 30
        limits:
          recommended: 1
        restrictions:
          - condition: "settings:storage.volumes_lvm.value == false"
            message: "Cinder LVM should be enabled in settings"
          # NOTE: https://bugs.launchpad.net/fuel/+bug/1372914 - Prohibit possibility of adding cinder nodes to an environment with Ceph RBD
          - condition: "settings:storage.volumes_ceph.value == true"
            message: "Ceph RBD cannot be used with Cinder"
      cinder-block-device:
        name: 'Storage - Cinder Block Device'
        description: 'Host node for Cinder Block Devices'
        has_primary: false
        public_ip_required: false
        weight: 35
        conflicts:
          - controller
          - cinder
          - cinder-vmware
          - ceph-osd
        restrictions:
          - condition: "settings:storage.volumes_block_device.value == false"
            message: "Cinder Block Device should be enabled in settings"
          - condition: "settings:storage.volumes_ceph.value == true"
            message: "Ceph RBD cannot be used with Cinder Block Device"
      cinder-vmware:
        name: "Storage - Cinder Proxy to VMware Datastore"
        description: "Cinder-VMware provides scheduling of block storage resources delivered over VMware vCenter. Block storage can be used for database storage, expandable file systems, or providing a server with access to raw block level devices."
        weight: 40
        limits:
          recommended: 1
        restrictions:
          - condition: "settings:common.use_vcenter.value == false"
            action: "hide"
      ceph-osd:
        name: "Storage - Ceph OSD"
        description: "Ceph storage can be configured to provide storage for block volumes (Cinder), images (Glance) and ephemeral instance storage (Nova). It can also provide object storage through the S3 and Swift API (See settings to enable each)."
        weight: 50
        limits:
            min: "settings:storage.osd_pool_size.value"
        restrictions:
          - condition: "settings:storage.volumes_ceph.value == false and settings:storage.images_ceph.value == false and settings:storage.ephemeral_ceph.value == false"
            message: "Ceph must be enabled in settings"
        update_once:
          - controller
      mongo:
        name: "Telemetry - MongoDB"
        description: "A feature-complete and recommended database for storage of metering data from OpenStack Telemetry (Ceilometer)."
        weight: 60
        conflicts:
          - compute
          - ceph-osd
        has_primary: true
        limits:
          min: 1
          overrides:
            - condition: "cluster:mode != 'ha_compact'"
              max: 1
              message: "At most 1 MongoDB node can be added for non-HA deployment"
            - condition: "cluster:mode == 'ha_compact'"
              recommended: 3
              message: "At least 3 MongoDB nodes are recommended for HA deployment."
        restrictions:
          - condition: "settings:additional_components.ceilometer.value == false"
            message: "Ceilometer should be enabled."
          - condition: "settings:additional_components.mongo.value == true"
            message: "You are already using external MongoDB."
      base-os:
        name: "Operating System"
        description: "Install base Operating System without additional packages and configuration."
        weight: 70
      virt:
        name: "Virtual"
        description: "ADVANCED: Make available possibilities to spawn vms on this node that can be assign as a normal nodes."
        weight: 80
        public_ip_required: true
        conflicts:
          - controller
          - base-os
        restrictions:
          - condition: "not ('advanced' in version:feature_groups)"
            action: "hide"
      compute-vmware:
        name: "Compute VMware"
        description: "A node that runs nova-compute with VCDriver, that manages ESXi computing resources via VMware vCenter."
        weight: 90
        conflicts:
          - controller
          - compute
          - cinder
          - cinder-block-device
          - ceph-osd
          - mongo
          - base-os
          - virt
          - ironic
        restrictions:
          - condition: "settings:common.use_vcenter.value == false"
            action: "hide"
      ironic:
        name: "Ironic"
        description: "Ironic conductor"
        weight: 100
        limits:
          min: 1
          recommended: 3
        conflicts:
          - compute
        restrictions:
          - condition: "settings:additional_components.ironic.value == false"
            message: "Ironic should be enabled."
    attributes_metadata:
      editable:
        kernel_params:
          kernel:
            value: "console=tty0 net.ifnames=0 biosdevname=0 rootdelay=90 nomodeset"
        repo_setup:
          metadata:
            label: "Repositories"
            weight: 50
            group: "general"
            always_editable: true
          repos:
            type: "custom_repo_configuration"
            extra_priority: null
            description: |
              Please note: the first repository will be considered the operating system mirror that will be used during node provisioning.
              To create a local repository mirror on the Fuel master node, please follow the instructions provided by running "fuel-createmirror --help" on the Fuel master node.
              Please make sure your Fuel master node has Internet access to the repository before attempting to create a mirror.
              For more details, please refer to the documentation (https://docs.mirantis.com/openstack/fuel/fuel-8.0/operations.html#external-ubuntu-ops).
            value:
              - type: "deb"
                name: "ubuntu"
                uri: "http://archive.ubuntu.com/ubuntu/"
                suite: "trusty"
                section: "main universe multiverse"
                priority: null
              - type: "deb"
                name: "ubuntu-updates"
                uri: "http://archive.ubuntu.com/ubuntu/"
                suite: "trusty-updates"
                section: "main universe multiverse"
                priority: null
              - type: "deb"
                name: "ubuntu-security"
                uri: "http://archive.ubuntu.com/ubuntu/"
                suite: "trusty-security"
                section: "main universe multiverse"
                priority: null
              - type: "deb"
                name: "mos"
                uri: "http://{settings.MASTER_IP}:8080/{cluster.release.version}/ubuntu/x86_64"
                suite: "mos8.0"
                section: "main restricted"
                priority: 1050
              - type: "deb"
                name: "mos-updates"
                uri: "http://mirror.fuel-infra.org/mos-repos/ubuntu/{cluster.release.environment_version}/"
                suite: "mos8.0-updates"
                section: "main restricted"
                priority: 1050
              - type: "deb"
                name: "mos-security"
                uri: "http://mirror.fuel-infra.org/mos-repos/ubuntu/{cluster.release.environment_version}/"
                suite: "mos8.0-security"
                section: "main restricted"
                priority: 1050
              - type: "deb"
                name: "mos-holdback"
                uri: "http://mirror.fuel-infra.org/mos-repos/ubuntu/{cluster.release.environment_version}/"
                suite: "mos8.0-holdback"
                section: "main restricted"
                priority: 1100
              - type: "deb"
                name: "Auxiliary"
                uri: "http://{settings.MASTER_IP}:8080/{cluster.release.version}/ubuntu/auxiliary"
                suite: "auxiliary"
                section: "main restricted"
                priority: 1150
        additional_components:
          metadata:
            label: "Additional Components"
            weight: 20
            group: "openstack_services"
          sahara:
            value: false
            label: "Install Sahara"
            description: "If selected, Sahara component will be installed"
            weight: 10
            type: "checkbox"
            restrictions:
              - condition: "true"
                action: disable
          murano:
            value: false
            label: "Install Murano"
            description: "If selected, Murano component will be installed"
            weight: 20
            type: "checkbox"
          murano-cfapi:
            value: false
            label: "Install Murano service broker for Cloud Foundry"
            description: "If selected, Murano service broker will be installed"
            weight: 30
            type: "checkbox"
            restrictions:
              - condition: "true"
                action: disable
          heat:
            value: true
            label: ""
            description: ""
            weight: 50
            type: "hidden"
          ceilometer:
            value: false
            label: "Install Ceilometer"
            description: "If selected, Ceilometer component will be installed"
            weight: 60
            type: "checkbox"
            restrictions:
              - condition: "true"
                action: disable
          mongo:
            value: false
            label: "Use external Mongo DB"
            description: "If selected, You can use external Mongo DB as ceilometer backend"
            weight: 70
            type: "checkbox"
            restrictions:
              - condition: "true"
                action: disable
          ironic:
            value: false
            label: "Install Ironic"
            description: "If selected, Ironic component will be installed"
            weight: 80
            type: "checkbox"
            restrictions:
              - "cluster:net_provider != 'neutron' or networking_parameters:segmentation_type != 'vlan'": "Ironic requires Neutron with VLAN segmentation."
              - "settings:storage.images_ceph.value == true and settings:storage.objects_ceph.value == false": "Ironic requires Swift or RadosGW for Glance images."

        common:
          metadata:
            label: "Common"
            weight: 30
          debug:
            value: false
            label: "OpenStack debug logging"
            description: "Debug logging mode provides more information, but requires more disk space."
            weight: 20
            type: "checkbox"
          puppet_debug:
            value: true
            label: "Puppet debug logging"
            description: "Debug puppet logging mode provides more information, but requires more disk space."
            weight: 20
            type: "checkbox"
          nova_quota:
            value: false
            label: "Nova quotas"
            description: "Quotas are used to limit CPU and memory usage for tenants. Enabling quotas will increase load on the Nova database."
            weight: 25
            type: "checkbox"
          auto_assign_floating_ip:
            value: false
            label: "Auto assign floating IP"
            description: "If selected, OpenStack will automatically assign a floating IP to a new instance"
            weight: 40
            type: "checkbox"
            restrictions:
              - condition: "cluster:net_provider == 'neutron'"
                action: "hide"
          use_vcenter:
            value: false
            weight: 30
            type: "hidden"
          libvirt_type:
            value: "qemu"
            values:
              - data: "kvm"
                label: "KVM"
                description: "Choose this type of hypervisor if you run OpenStack on hardware"
                restrictions:
                  - condition: "true"
                    action: disable
              - data: "qemu"
                label: "QEMU"
                description: "Choose this type of hypervisor if you run OpenStack on virtual hosts."
                restrictions:
                  - condition: "true"
                    action: disable
            label: "Hypervisor type"
            weight: 30
            type: "radio"
          resume_guests_state_on_host_boot:
            value: true
            label: "Resume guests state on host boot"
            description: "Whether to resume previous guests state when the host reboots. If enabled, this option causes guests assigned to the host to resume their previous state. If the guest was running a restart will be attempted when nova-compute starts. If the guest was not running previously, a restart will not be attempted."
            weight: 60
            type: "checkbox"
          use_cow_images:
            value: true
            label: "Use qcow format for images"
            description: "For most cases you will want qcow format. If it's disabled, raw image format will be used to run VMs. OpenStack with raw format currently does not support snapshotting."
            weight: 50
            type: "checkbox"
          auth_key:
            value: ""
            label: "Public Key"
            description: "Public key(s) to include in authorized_keys on deployed nodes"
            weight: 70
            type: "textarea"
        external_ntp:
          metadata:
            label: "Host OS NTP Servers"
            weight: 100
          ntp_list:
            value: "0.pool.ntp.org,1.pool.ntp.org,2.pool.ntp.org,3.pool.ntp.org"
            label: "NTP server list"
            description: "List of upstream NTP servers, separated by comma"
            weight: 10
            type: "text"
            regex:
              source: '^\s*(?:(?:\w+(?:-+\w+)*\.)+[a-z]+|\d{1,3}(?:\.\d{1,3}){3})\s*(?:,\s*(?:(?:\w+(?:-+\w+)*\.)+[a-z]+|\d{1,3}(\.\d{1,3}){3})\s*)*$'
              error: "Invalid NTP server list"
      generated:
        repo_setup:
          installer_kernel:
            remote_relative: "dists/trusty/main/installer-amd64/current/images/netboot/ubuntu-installer/amd64/linux"
            local: "/var/www/nailgun/ubuntu/x86_64/images/linux"
          installer_initrd:
            remote_relative: "dists/trusty/main/installer-amd64/current/images/netboot/ubuntu-installer/amd64/initrd.gz"
            local: "/var/www/nailgun/ubuntu/x86_64/images/initrd.gz"
        cobbler:
          profile:
            generator_arg: "ubuntu_1404_x86_64"
        provision:
          codename: "trusty"
          image_data:
            /:
              uri: "http://{settings.MASTER_IP}:8080/targetimages/env_{cluster.id}_ubuntu_1404_amd64.img.gz"
              format: "ext4"
              container: "gzip"
            /boot:
              uri: "http://{settings.MASTER_IP}:8080/targetimages/env_{cluster.id}_ubuntu_1404_amd64-boot.img.gz"
              format: "ext2"
              container: "gzip"
    wizard_metadata:
      Mode:
        metadata:
          restrictions:
            - condition: "true"
              action: "hide"
        mode:
          type: "radio"
          bind: "cluster:mode"
          values:
          - data: "ha_compact"
            label: "cluster.mode.ha_compact"
      Compute:
        hypervisor:
          type: "radio"
          value: "qemu"
          weight: 5
          bind: "settings:common.libvirt_type.value"
          values:
            - data: "kvm"
              label: "dialog.create_cluster_wizard.compute.kvm"
              description: "dialog.create_cluster_wizard.compute.kvm_description"
              bind:
                - "wizard:Storage.ceph": "disable"
                - "wizard:Network.manager": "neutron-vlan"
              restrictions:
                - condition: "true"
                  action: disable
            - data: "qemu"
              label: "dialog.create_cluster_wizard.compute.qemu"
              description: "dialog.create_cluster_wizard.compute.qemu_description"
              bind:
                - "wizard:Storage.ceph": "disable"
                - "wizard:Network.manager": "neutron-vlan"
        vcenter:
          type: "checkbox"
          weight: 10
          label: "dialog.create_cluster_wizard.compute.vcenter"
          description: "dialog.create_cluster_wizard.compute.vcenter_description"
          bind:
            - "wizard:Storage.ceph": "disable"
            - "wizard:Network.manager": "nova-network"
            - "settings:common.use_vcenter.value"
          restrictions:
            - condition: "true"
              action: disable
      Network:
        manager:
          type: "radio"
          value: "nova-network"
          values:
            - data: "neutron-vlan"
              label: "common.network.neutron_vlan"
              description: "dialog.create_cluster_wizard.network.neutron_vlan_description"
              restrictions:
                - "Compute.vcenter == true": "dialog.create_cluster_wizard.network.hypervisor_alert"
              bind:
                - "cluster:net_provider": "neutron"
                - "cluster:net_segment_type": "vlan"
            - data: "neutron-tun"
              label: "common.network.neutron_tun"
              description: "dialog.create_cluster_wizard.network.neutron_tun_description"
              restrictions:
                - condition: "true"
                  action: disable
              bind:
                - "cluster:net_provider": "neutron"
                - "cluster:net_segment_type": "tun"
            - data: "nova-network"
              label: "dialog.create_cluster_wizard.network.nova_network"
              description: "dialog.create_cluster_wizard.network.nova_network_description"
              restrictions:
                - "Compute.vcenter == false": "dialog.create_cluster_wizard.network.nova_network_vcenter_alert"
              bind:
                - "cluster:net_provider": "nova_network"
              restrictions:
                - condition: "true"
                  action: disable
      Storage:
        ceph:
          type: "radio"
          values:
            - data: "disable"
              label: "dialog.create_cluster_wizard.storage.ceph_disable"
              bind:
                - "settings:storage.volumes_lvm.value": true
                - "settings:storage.volumes_ceph.value": false
                - "settings:storage.objects_ceph.value": false
                - "settings:storage.ephemeral_ceph.value": false
                - "settings:storage.images_ceph.value": false
              restrictions:
                - condition: "true"
                  action: disable
                - condition: "true"
                  message: "The XenServer OpenStack release has been chosen. Ceph is not a supported option."
            - data: "enable"
              label: "dialog.create_cluster_wizard.storage.ceph_enable"
              bind:
                - "settings:storage.volumes_ceph.value": true
                - "settings:storage.objects_ceph.value": true
                - "settings:storage.ephemeral_ceph.value": true
                - "settings:storage.images_ceph.value": true
                - "settings:storage.volumes_lvm.value": false
              restrictions:
                - condition: "true"
                  action: disable
      AdditionalServices:
        sahara:
          type: "checkbox"
          label: "dialog.create_cluster_wizard.additional.install_sahara"
          description: "dialog.create_cluster_wizard.additional.install_sahara_description"
          bind: "settings:additional_components.sahara.value"
          weight: 10
          restrictions:
            - condition: "true"
              action: disable
            - condition: "true"
              message: "The XenServer OpenStack release has been chosen. No additional services are supported in this combination."
        murano:
          type: "checkbox"
          label: "dialog.create_cluster_wizard.additional.install_murano"
          description: "dialog.create_cluster_wizard.additional.install_murano_description"
          bind: "settings:additional_components.murano.value"
          weight: 20
          restrictions:
            - condition: "true"
              action: disable
        ceilometer:
          type: "checkbox"
          label: "dialog.create_cluster_wizard.additional.install_ceilometer"
          description: "dialog.create_cluster_wizard.additional.install_ceilometer_description"
          bind: "settings:additional_components.ceilometer.value"
          weight: 30
        ironic:
          type: "checkbox"
          label: "dialog.create_cluster_wizard.additional.install_ironic"
          description: "dialog.create_cluster_wizard.additional.install_ironic_description"
          bind: "settings:additional_components.ironic.value"
          weight: 40
          restrictions:
            - condition: "true"
              action: disable
      Ready: {}